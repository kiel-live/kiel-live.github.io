{"version":3,"file":"useFeatureFlags-NVyzKgZM.js","sources":["../../src/compositions/useFeatureFlags.ts"],"sourcesContent":["import type { Ref } from 'vue';\nimport { useStorage } from '@vueuse/core';\nimport { computed, getCurrentInstance } from 'vue';\nimport { useI18n } from 'vue-i18n';\n\nimport { localStoragePrefix } from './useUserSettings';\n\nconst enabledFeatureFlags = useStorage<string[]>(`${localStoragePrefix}.feature_flags`, []);\n\ninterface FeatureFlag {\n  id: string;\n  name: string;\n  description?: string;\n}\n\nexport function useFeatureFlags() {\n  // as i18n can only be used inside components and translations\n  // are only needed for the settings we mock it otherwise\n  let t: ReturnType<typeof useI18n>['t'] = (key) => key;\n  if (getCurrentInstance()) {\n    t = useI18n().t;\n  }\n\n  const featureFlags = [\n    {\n      id: 'new_api',\n      name: t('feature_flag_new_api'),\n    },\n    {\n      id: 'vehicle_stop_actions',\n      name: t('feature_flag_actions'),\n      description: t('feature_flag_actions_description'),\n    },\n  ] satisfies FeatureFlag[];\n\n  const featureFlagWithEnabled = featureFlags.map((flag) => ({\n    ...flag,\n    enabled: computed({\n      get: () => enabledFeatureFlags.value.includes(flag.id),\n      set: (value) => {\n        if (value) {\n          enabledFeatureFlags.value = [...enabledFeatureFlags.value, flag.id];\n        } else {\n          enabledFeatureFlags.value = enabledFeatureFlags.value.filter((f) => f !== flag.id);\n        }\n      },\n    }),\n  }));\n\n  function checkFeatureFlag(flagId: string): Ref<boolean> {\n    const featureFlag = featureFlagWithEnabled.find((flag) => flag.id === flagId);\n\n    if (!featureFlag) {\n      throw new Error(`Unknown feature flag: ${flagId}`);\n    }\n\n    return featureFlag.enabled;\n  }\n\n  return {\n    featureFlags: featureFlagWithEnabled,\n    checkFeatureFlag,\n  };\n}\n"],"names":["enabledFeatureFlags","useStorage","localStoragePrefix","useFeatureFlags","key","getCurrentInstance","useI18n","featureFlagWithEnabled","flag","computed","value","f","checkFeatureFlag","flagId","featureFlag"],"mappings":"uEAOA,MAAMA,EAAsBC,EAAqB,GAAGC,CAAkB,iBAAkB,CAAA,CAAE,EAQnF,SAASC,GAAkB,CAGhC,IAAI,EAAsCC,GAAQA,EAC9CC,MACF,EAAIC,IAAU,GAehB,MAAMC,EAZe,CACnB,CACE,GAAI,UACJ,KAAM,EAAE,sBAAsB,CAAA,EAEhC,CACE,GAAI,uBACJ,KAAM,EAAE,sBAAsB,EAC9B,YAAa,EAAE,kCAAkC,CAAA,CACnD,EAG0C,IAAKC,IAAU,CACzD,GAAGA,EACH,QAASC,EAAS,CAChB,IAAK,IAAMT,EAAoB,MAAM,SAASQ,EAAK,EAAE,EACrD,IAAME,GAAU,CACVA,EACFV,EAAoB,MAAQ,CAAC,GAAGA,EAAoB,MAAOQ,EAAK,EAAE,EAElER,EAAoB,MAAQA,EAAoB,MAAM,OAAQW,GAAMA,IAAMH,EAAK,EAAE,CAErF,CAAA,CACD,CAAA,EACD,EAEF,SAASI,EAAiBC,EAA8B,CACtD,MAAMC,EAAcP,EAAuB,KAAMC,GAASA,EAAK,KAAOK,CAAM,EAE5E,GAAI,CAACC,EACH,MAAM,IAAI,MAAM,yBAAyBD,CAAM,EAAE,EAGnD,OAAOC,EAAY,OACrB,CAEA,MAAO,CACL,aAAcP,EACd,iBAAAK,CAAA,CAEJ"}